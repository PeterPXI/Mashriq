<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover" />
    <meta name="theme-color" content="#0a0f1c" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <title>تسجيل الدخول | مشرق</title>
    <meta name="description" content="سجل دخولك إلى مشرق للوصول لحسابك ومنتجاتك" />
    <!-- Bootstrap 5 RTL -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800;900&display=swap" rel="stylesheet" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <!-- Custom Styles (Override Bootstrap) -->
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="auth.css" />
  </head>
  <body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg fixed-top">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
          <img src="logo.png" alt="مشرق" class="logo-img" />
          <span class="brand-text">مشرق</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarMain">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="index.html">الرئيسية</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="products.html">المنتجات</a>
            </li>
          </ul>
          <div class="d-flex gap-2">
            <a href="register.html" class="btn btn-primary btn-sm">
              <i class="fas fa-user-plus me-1"></i>
              إنشاء حساب
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="auth-page">
      <div class="auth-container login-container">
        <!-- Left Side - Visual -->
        <div class="auth-visual-section login-visual">
          <div class="visual-content">
            <div class="visual-icon">
              <i class="fas fa-door-open"></i>
            </div>
            <h3>مرحباً بعودتك!</h3>
            <p>سجل دخولك للوصول إلى لوحة تحكمك ومنتجاتك</p>
            
            <div class="visual-illustration">
              <div class="floating-shape shape-1"></div>
              <div class="floating-shape shape-2"></div>
              <div class="floating-shape shape-3"></div>
            </div>
          </div>
        </div>

        <!-- Right Side - Form -->
        <div class="auth-form-section">
          <div class="auth-header">
            <span class="chip">
              <i class="fas fa-sign-in-alt"></i>
              تسجيل الدخول
            </span>
            <h2>مرحباً بك مجدداً</h2>
            <p>أدخل بياناتك للوصول إلى حسابك</p>
          </div>

          <form id="loginForm" class="auth-form">
            <div class="form-group">
              <label for="email">البريد الإلكتروني</label>
              <div class="input-wrapper">
                <i class="fas fa-envelope"></i>
                <input type="email" id="email" name="email" placeholder="example@email.com" required />
              </div>
            </div>

            <div class="form-group">
              <label for="password">كلمة المرور</label>
              <div class="input-wrapper">
                <i class="fas fa-lock"></i>
                <input type="password" id="password" name="password" placeholder="••••••••" required />
                <button type="button" class="toggle-password" onclick="togglePassword('password', this)">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>

            <div class="form-options">
              <label class="checkbox-container">
                <input type="checkbox" id="rememberMe" name="rememberMe" />
                <span class="checkmark"></span>
                تذكرني
              </label>
              <a href="#" class="forgot-link">نسيت كلمة المرور؟</a>
            </div>

            <button type="submit" class="btn primary lg full-width" id="submitBtn">
              <i class="fas fa-sign-in-alt"></i>
              تسجيل الدخول
            </button>

            <div class="divider">
              <span>أو</span>
            </div>

            <div class="demo-accounts">
              <p class="demo-label">حسابات تجريبية للاختبار:</p>
              <div class="demo-buttons">
                <button type="button" class="btn sm glass demo-btn" onclick="fillDemoAccount('student')">
                  <i class="fas fa-user-graduate"></i>
                  طالب
                </button>
                <button type="button" class="btn sm glass demo-btn" onclick="fillDemoAccount('seller')">
                  <i class="fas fa-store"></i>
                  بائع
                </button>
              </div>
            </div>

            <div class="auth-footer">
              <p>ليس لديك حساب؟ <a href="register.html">أنشئ حساباً الآن</a></p>
            </div>
          </form>
        </div>
      </div>
    </main>

    <!-- FOOTER -->
    <footer class="auth-bottom-footer">
      <p>© <span id="year"></span> مشرق — جميع الحقوق محفوظة</p>
    </footer>

    <script src="api.js"></script>
    <script src="app.js"></script>
    <script>
      // Set year
      document.getElementById('year').textContent = new Date().getFullYear();

      // Toggle password visibility
      function togglePassword(inputId, btn) {
        const input = document.getElementById(inputId);
        const icon = btn.querySelector('i');
        
        if (input.type === 'password') {
          input.type = 'text';
          icon.classList.replace('fa-eye', 'fa-eye-slash');
        } else {
          input.type = 'password';
          icon.classList.replace('fa-eye-slash', 'fa-eye');
        }
      }

      // Demo account data
      const demoAccounts = {
        student: {
          email: 'student@demo.com',
          password: 'demo123'
        },
        seller: {
          email: 'seller@demo.com',
          password: 'demo123'
        }
      };

      // Fill demo account
      function fillDemoAccount(type) {
        const account = demoAccounts[type];
        document.getElementById('email').value = account.email;
        document.getElementById('password').value = account.password;
        UI.showToast('تم ملء بيانات الحساب التجريبي - اضغط تسجيل الدخول', 'info');
      }

      // Form submission - Strict API
      document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const submitBtn = document.getElementById('submitBtn');
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        // Disable button during request
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري تسجيل الدخول...';

        try {
          // Try API first
          const result = await API.auth.login(email, password);

          if (result && result.success) {
            UI.showToast('تم تسجيل الدخول بنجاح! مرحباً بك 👋', 'success');
            setTimeout(() => {
              window.location.href = 'dashboard.html';
            }, 1500);
          } else {
            UI.showToast(result.message || 'فشل تسجيل الدخول', 'error');
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> تسجيل الدخول';
          }
        } catch (error) {
          console.error('Login error:', error);
          UI.showToast('حدث خطأ في الاتصال بالخادم', 'error');
          submitBtn.disabled = false;
          submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> تسجيل الدخول';
        }
      });

      // Redirect if already logged in
      if (API.auth.isLoggedIn() || UserManager.isLoggedIn()) {
        window.location.href = 'dashboard.html';
      }
    </script>
    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>



